<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wired - Document Repository</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>THE WIRED</h1>
        <p style="color: #66ff66; margin-top: 0.5rem;">Secure Document Repository</p>
    </header>

    <nav>
        <a href="{{ url_for('index') }}" class="active">Browse Files</a>
        <a href="{{ url_for('upload') }}">Upload Document</a>
    </nav>

    <main>
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Search Section -->
        <section class="search-section">
            <h2>Search Documents</h2>
            <form method="GET" class="search-form">
                <input 
                    type="text" 
                    name="search" 
                    placeholder="Search by filename or description..." 
                    value="{{ search_query or '' }}"
                    class="search-input"
                >
                <button type="submit" class="btn">Search</button>
                {% if search_query %}
                    <a href="{{ url_for('index') }}" class="btn">Clear</a>
                {% endif %}
            </form>
            {% if search_query %}
                <p style="margin-top: 1rem; color: #66ff66;">
                    Showing results for: <strong>"{{ search_query }}"</strong>
                </p>
            {% endif %}
        </section>

        <!-- Statistics -->
        <section class="stats-section" id="stats-section">
            <h3>Repository Statistics</h3>
            <div class="stats-grid" id="stats-grid">
                <div class="loading"></div>
            </div>
        </section>

        <!-- Files Section -->
        <section>
            <h2 style="margin-bottom: 1rem;">
                {% if search_query %}
                    Search Results ({{ files|length }})
                {% else %}
                    All Documents ({{ files|length }})
                {% endif %}
            </h2>

            {% if files %}
                <div class="file-grid">
                    {% for file in files %}
                        <div class="file-card">
                            <div class="file-header">
                                <div>
                                    <div class="file-name">{{ file.original_name }}</div>
                                    <div class="file-type">{{ file.original_name.split('.')[-1].upper() }}</div>
                                </div>
                            </div>
                            
                            <div class="file-meta">
                                <div><strong>Size:</strong> {{ file.file_size }} MB</div>
                                <div><strong>Type:</strong> {{ file.file_type }}</div>
                                <div><strong>Uploaded:</strong> {{ file.upload_date.split('T')[0] }}</div>
                            </div>

                            {% if file.description and file.description != 'No description' %}
                                <div class="file-description">
                                    "{{ file.description }}"
                                </div>
                            {% endif %}

                            <div class="file-actions">
                                <a href="{{ url_for('download', file_id=file.id) }}" class="btn btn-sm">
                                    Download
                                </a>
                                <form method="POST" action="{{ url_for('delete', file_id=file.id) }}" 
                                      style="display: inline-block;" 
                                      onsubmit="return confirm('Are you sure you want to delete this file?')">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    {% if search_query %}
                        <h3>No files found</h3>
                        <p>No documents match your search criteria.</p>
                        <a href="{{ url_for('index') }}" class="btn" style="margin-top: 1rem;">Show All Files</a>
                    {% else %}
                        <h3>No documents uploaded yet</h3>
                        <p>Be the first to upload a document to The Wired.</p>
                        <a href="{{ url_for('upload') }}" class="btn" style="margin-top: 1rem;">Upload Document</a>
                    {% endif %}
                </div>
            {% endif %}
        </section>
    </main>

    <script>
        // Load statistics
        fetch('/api/stats')
            .then(response => response.json())
            .then(data => {
                const statsGrid = document.getElementById('stats-grid');
                statsGrid.innerHTML = `
                    <div class="stat-item">
                        <div class="stat-value">${data.total_files}</div>
                        <div class="stat-label">Total Files</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.total_size_mb}</div>
                        <div class="stat-label">Total Size (MB)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${Object.keys(data.file_types).length}</div>
                        <div class="stat-label">File Types</div>
                    </div>
                `;
            })
            .catch(error => {
                const statsGrid = document.getElementById('stats-grid');
                statsGrid.innerHTML = '<div style="color: #ff0066;">Error loading statistics</div>';
            });

        // Auto-focus search input
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('.search-input');
            if (searchInput && !searchInput.value) {
                searchInput.focus();
            }
        });
    </script>
</body>
</html>
